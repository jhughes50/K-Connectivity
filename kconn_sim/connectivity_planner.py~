"""
Author: Jason Hughes
Date: June 2023
About: Multi-Layer K-Connectivity planner
"""

class ConnectivityPlanner:

    def __init__(self):

        self.num_agents_ = 0
        self.type0_ = 0
        self.type1_ = 0

        self.connectivity_radius_ = 0
        self.safety_radius_ = 0

        self.magnitude_ = 1
        
        self.dimension_ = 2


    @property
    def num_agents(self):
        return self.num_agents_

    @num_agents.setter
    def num_agents(self, n):
        self.num_agents_ = n

    @property
    def type0(self):
        return self.type0_

    @type0.setter
    def type0(self, n):
        self.type0_ = n

    @property
    def type1(self):
        return self.type1_


    @type1.setter
    def type1(self, n):
        self.type1_ = n

    @property
    def connectivity_radius(self):
        return self.connectivity_radius_

    @connectivity_radius.setter
    def connectivity_radius(self, r):
        self.connectivity_radius_ = r

    @property
    def safety_radius(self):
        return self.safety_radius_

    @safety_radius.setter
    def safety_radius(self, r):
        self.safety_radius_ = r

    @property
    def magnitude(self):
        return self.magnitude_

    @magnitude.setter
    def magnitude(self, m):
        self.magnitude_ = m

    @property
    def dimension(self):
        return self.dimension_

    @dimension.setter
    def dimension(self, d):
        self.dimension_ = d

        
    def connection_constraint(self, u):
        res = list()
        u = np.reshape(u,(self.num_agents, self.dim))

        for i in range(self.num_agents-1):
            for j in range(i+1,self.num_agents):
                d = math.dist(self.locations[i] + u[i],
                          self.locations[j] + u[j])
                res.append(self.r_conn - d)
                
        return np.array(res)*self.conn_vec

    
    def safety_constraint(self, u):
        res = list()
        u = np.reshape(u,(self.num_agents,self.dim))

        for i in range(self.num_agents-1):
            for j in range(i+1, self.num_agents):
                d = math.dist(self.locations[i]+u[i], self.locations[j]+u[j])
                res.append(d - self.r_safety)

        return np.array(res)
